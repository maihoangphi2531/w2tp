local maxGold = 99999999 -- Giá trị vàng tối đa để kích hoạt dịch chuyển
local placeId1 = 4310463940 -- PlaceId để dịch chuyển lần đầu
local placeId2 = 4310463616 -- PlaceId để dịch chuyển sau 3 phút
local player = game:GetService("Players").LocalPlayer
local teleportService = game:GetService("TeleportService")

-- Hàm kiểm tra nếu đang ở PlaceId
local function isInPlace(placeId)
    return game.PlaceId == placeId
end

-- Hàm dịch chuyển đến PlaceId với cơ chế thử lại và tự kick nếu thất bại
local function teleportWithRetries(placeId, maxRetries)
    maxRetries = maxRetries or 10 -- Nếu không chỉ định, sẽ thử tối đa 10 lần

    for attempt = 1, maxRetries do
        -- Nếu đã ở đúng nơi, trả về thành công và thoát
        if isInPlace(placeId) then
            warn("Đã ở đúng địa điểm: " .. placeId)
            return true 
        end

        warn("Đang thử dịch chuyển đến " .. placeId .. ", lần thử " .. attempt .. "/" .. maxRetries)
        
        -- Sử dụng pcall để bắt lỗi nếu TeleportService gặp sự cố
        local success, err = pcall(function()
            teleportService:Teleport(placeId, player)
        end)

        if not success then
            warn("Lỗi khi gọi TeleportService: " .. tostring(err))
        end

        -- Đợi một khoảng thời gian để game có thời gian chuyển server
        task.wait(15) -- Chờ 15 giây giữa các lần thử

        -- Kiểm tra lại sau khi chờ
        if isInPlace(placeId) then
            warn("Dịch chuyển thành công đến " .. placeId)
            return true -- Thoát khỏi hàm nếu thành công
        end
    end

    -- [[ THAY ĐỔI Ở ĐÂY ]] --
    -- Nếu vòng lặp kết thúc mà không thành công, thực hiện kick người chơi
    warn("Dịch chuyển thất bại sau " .. maxRetries .. " lần thử. Sẽ tự động kick để restart.")
    player:Kick("Tự động khởi động lại: Dịch chuyển thất bại nhiều lần.")
    -- [[ KẾT THÚC THAY ĐỔI ]] --
    
    return false -- Dòng này có thể không bao giờ được chạy, nhưng vẫn giữ để logic hoàn chỉnh
end

-- Hàm kiểm tra giá trị vàng
local function getGoldValue()
    -- Sử dụng pcall để tránh lỗi nếu các đối tượng GUI chưa được tải
    local success, goldValue = pcall(function()
        local goldValueObject = player:WaitForChild("PlayerGui")
                                    :WaitForChild("Profile")
                                    :WaitForChild("Currency")
                                    :WaitForChild("Gold")
        return goldValueObject.Value
    end)

    if success then
        return goldValue
    else
        return nil
    end
end

-- Hàm tổng hợp xử lý dịch chuyển
local function handleTeleport()
    local currentGold = getGoldValue()
    if currentGold and currentGold >= maxGold then
        warn("Vàng đã đầy, bắt đầu quá trình dịch chuyển.")
        
        -- Thử dịch chuyển đến placeId1
        local success1 = teleportWithRetries(placeId1, 10)

        -- Chỉ tiếp tục nếu việc dịch chuyển đầu tiên thành công
        if success1 then
            warn("Đã đến placeId1. Bắt đầu chờ 3 phút...")
            task.wait(180) -- Đợi 3 phút
            warn("Đã hết 3 phút. Chuẩn bị dịch chuyển đến placeId2.")
            
            -- Thử dịch chuyển đến placeId2
            teleportWithRetries(placeId2, 10)
        else
            -- Về mặt lý thuyết, dòng này sẽ không được chạy vì script sẽ kick người chơi trước
            warn("Không thể dịch chuyển đến placeId1. Hủy bỏ quá trình.")
        end
    end
end

-- Chạy trong một vòng lặp để liên tục kiểm tra vàng
while true do
    -- Bọc trong pcall để toàn bộ script không bị dừng nếu có lỗi bất ngờ
    pcall(handleTeleport)
    task.wait(10) -- Kiểm tra vàng mỗi 10 giây
end
